var ae=Object.create;var I=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var ue=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty;var E=n=>I(n,"__esModule",{value:!0});var k=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports),de=(n,r)=>{for(var o in r)I(n,o,{get:r[o],enumerable:!0})},F=(n,r,o,_)=>{if(r&&typeof r=="object"||typeof r=="function")for(let p of ce(r))!fe.call(n,p)&&(o||p!=="default")&&I(n,p,{get:()=>r[p],enumerable:!(_=se(r,p))||_.enumerable});return n},W=(n,r)=>F(E(I(n!=null?ae(ue(n)):{},"default",!r&&n&&n.__esModule?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n),le=(n=>(r,o)=>n&&n.get(r)||(o=F(E({}),r,1),n&&n.set(r,o),o))(typeof WeakMap!="undefined"?new WeakMap:0);var C=(n,r,o)=>new Promise((_,p)=>{var w=h=>{try{d(o.next(h))}catch(f){p(f)}},R=h=>{try{d(o.throw(h))}catch(f){p(f)}},d=h=>h.done?_(h.value):Promise.resolve(h.value).then(w,R);d((o=o.apply(n,r)).next())});var D=k((S,L)=>{(function(n,r){typeof S=="object"?L.exports=S=r():typeof define=="function"&&define.amd?define([],r):n.CryptoJS=r()})(S,function(){var n=n||function(r,o){var _=Object.create||function(){function e(){}return function(t){var c;return e.prototype=t,c=new e,e.prototype=null,c}}(),p={},w=p.lib={},R=w.Base=function(){return{extend:function(e){var t=_(this);return e&&t.mixIn(e),(!t.hasOwnProperty("init")||this.init===t.init)&&(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=w.WordArray=R.extend({init:function(e,t){e=this.words=e||[],t!=o?this.sigBytes=t:this.sigBytes=e.length*4},toString:function(e){return(e||f).stringify(this)},concat:function(e){var t=this.words,c=e.words,i=this.sigBytes,g=e.sigBytes;if(this.clamp(),i%4)for(var v=0;v<g;v++){var b=c[v>>>2]>>>24-v%4*8&255;t[i+v>>>2]|=b<<24-(i+v)%4*8}else for(var v=0;v<g;v+=4)t[i+v>>>2]=c[v>>>2];return this.sigBytes+=g,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=r.ceil(t/4)},clone:function(){var e=R.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],c=function(y){var y=y,A=987654321,B=4294967295;return function(){A=36969*(A&65535)+(A>>16)&B,y=18e3*(y&65535)+(y>>16)&B;var x=(A<<16)+y&B;return x/=4294967296,x+=.5,x*(r.random()>.5?1:-1)}},i=0,g;i<e;i+=4){var v=c((g||r.random())*4294967296);g=v()*987654071,t.push(v()*4294967296|0)}return new d.init(t,e)}}),h=p.enc={},f=h.Hex={stringify:function(e){for(var t=e.words,c=e.sigBytes,i=[],g=0;g<c;g++){var v=t[g>>>2]>>>24-g%4*8&255;i.push((v>>>4).toString(16)),i.push((v&15).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,c=[],i=0;i<t;i+=2)c[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new d.init(c,t/2)}},m=h.Latin1={stringify:function(e){for(var t=e.words,c=e.sigBytes,i=[],g=0;g<c;g++){var v=t[g>>>2]>>>24-g%4*8&255;i.push(String.fromCharCode(v))}return i.join("")},parse:function(e){for(var t=e.length,c=[],i=0;i<t;i++)c[i>>>2]|=(e.charCodeAt(i)&255)<<24-i%4*8;return new d.init(c,t)}},a=h.Utf8={stringify:function(e){try{return decodeURIComponent(escape(m.stringify(e)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(e){return m.parse(unescape(encodeURIComponent(e)))}},u=w.BufferedBlockAlgorithm=R.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=a.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,c=t.words,i=t.sigBytes,g=this.blockSize,v=g*4,b=i/v;e?b=r.ceil(b):b=r.max((b|0)-this._minBufferSize,0);var y=b*g,A=r.min(y*4,i);if(y){for(var B=0;B<y;B+=g)this._doProcessBlock(c,B);var x=c.splice(0,y);t.sigBytes-=A}return new d.init(x,A)},clone:function(){var e=R.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),s=w.Hasher=u.extend({cfg:R.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:512/32,_createHelper:function(e){return function(t,c){return new e.init(c).finalize(t)}},_createHmacHelper:function(e){return function(t,c){return new l.HMAC.init(e,c).finalize(t)}}}),l=p.algo={};return p}(Math);return n})});var $=k((U,q)=>{(function(n,r){typeof U=="object"?q.exports=U=r(D()):typeof define=="function"&&define.amd?define(["./core"],r):r(n.CryptoJS)})(U,function(n){return function(r){var o=n,_=o.lib,p=_.WordArray,w=_.Hasher,R=o.algo,d=[],h=[];(function(){function a(e){for(var t=r.sqrt(e),c=2;c<=t;c++)if(!(e%c))return!1;return!0}function u(e){return(e-(e|0))*4294967296|0}for(var s=2,l=0;l<64;)a(s)&&(l<8&&(d[l]=u(r.pow(s,1/2))),h[l]=u(r.pow(s,1/3)),l++),s++})();var f=[],m=R.SHA256=w.extend({_doReset:function(){this._hash=new p.init(d.slice(0))},_doProcessBlock:function(a,u){for(var s=this._hash.words,l=s[0],e=s[1],t=s[2],c=s[3],i=s[4],g=s[5],v=s[6],b=s[7],y=0;y<64;y++){if(y<16)f[y]=a[u+y]|0;else{var A=f[y-15],B=(A<<25|A>>>7)^(A<<14|A>>>18)^A>>>3,x=f[y-2],ee=(x<<15|x>>>17)^(x<<13|x>>>19)^x>>>10;f[y]=B+f[y-7]+ee+f[y-16]}var re=i&g^~i&v,te=l&e^l&t^e&t,ne=(l<<30|l>>>2)^(l<<19|l>>>13)^(l<<10|l>>>22),ie=(i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25),T=b+ie+re+h[y]+f[y],oe=ne+te;b=v,v=g,g=i,i=c+T|0,c=t,t=e,e=l,l=T+oe|0}s[0]=s[0]+l|0,s[1]=s[1]+e|0,s[2]=s[2]+t|0,s[3]=s[3]+c|0,s[4]=s[4]+i|0,s[5]=s[5]+g|0,s[6]=s[6]+v|0,s[7]=s[7]+b|0},_doFinalize:function(){var a=this._data,u=a.words,s=this._nDataBytes*8,l=a.sigBytes*8;return u[l>>>5]|=128<<24-l%32,u[(l+64>>>9<<4)+14]=r.floor(s/4294967296),u[(l+64>>>9<<4)+15]=s,a.sigBytes=u.length*4,this._process(),this._hash},clone:function(){var a=w.clone.call(this);return a._hash=this._hash.clone(),a}});o.SHA256=w._createHelper(m),o.HmacSHA256=w._createHmacHelper(m)}(Math),n.SHA256})});var N=k((O,M)=>{(function(n,r){typeof O=="object"?M.exports=O=r(D()):typeof define=="function"&&define.amd?define(["./core"],r):r(n.CryptoJS)})(O,function(n){return function(){var r=n,o=r.lib,_=o.WordArray,p=r.enc,w=p.Base64={stringify:function(d){var h=d.words,f=d.sigBytes,m=this._map;d.clamp();for(var a=[],u=0;u<f;u+=3)for(var s=h[u>>>2]>>>24-u%4*8&255,l=h[u+1>>>2]>>>24-(u+1)%4*8&255,e=h[u+2>>>2]>>>24-(u+2)%4*8&255,t=s<<16|l<<8|e,c=0;c<4&&u+c*.75<f;c++)a.push(m.charAt(t>>>6*(3-c)&63));var i=m.charAt(64);if(i)for(;a.length%4;)a.push(i);return a.join("")},parse:function(d){var h=d.length,f=this._map,m=this._reverseMap;if(!m){m=this._reverseMap=[];for(var a=0;a<f.length;a++)m[f.charCodeAt(a)]=a}var u=f.charAt(64);if(u){var s=d.indexOf(u);s!==-1&&(h=s)}return R(d,h,m)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function R(d,h,f){for(var m=[],a=0,u=0;u<h;u++)if(u%4){var s=f[d.charCodeAt(u-1)]<<u%4*2,l=f[d.charCodeAt(u)]>>>6-u%4*2;m[a>>>2]|=(s|l)<<24-a%4*8,a++}return _.create(m,a)}}(),n.enc.Base64})});var me={};de(me,{OAuthErrorCode:()=>z,OAuthExtension:()=>Z,OAuthPayloadMethods:()=>P});var X=require("magic-sdk");var P=(r=>(r.ParseRedirectResult="magic_oauth_parse_redirect_result",r))(P||{}),z=(a=>(a.InvalidRequest="invalid_request",a.InvalidClient="invalid_client",a.InvalidScope="invalid_scope",a.InvalidGrant="invalid_grant",a.UnauthorizedClient="unauthorized_client",a.UnsupportedResponseType="unsupported_response_type",a.UnsupportedGrantType="unsupported_grant_type",a.UnsupportedTokenType="unsupported_token_type",a.AccessDenied="access_denied",a.ServerError="server_error",a.TemporarilyUnavailable="temporarily_unavailable",a))(z||{});var j=W($()),J=W(N()),V="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",K=typeof window!="undefined"&&!!window.crypto,he=K&&!!window.crypto.subtle;function pe(n){return Array.from(n).map(r=>V[r%V.length]).join("")}function Y(n){let r=o=>o.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");if(n instanceof ArrayBuffer){let o=new Uint8Array(n),_=Array.from(o).map(w=>String.fromCharCode(w)).join(""),p=btoa(_);return r(p)}return r(J.default.stringify(n))}function ve(n){return C(this,null,function*(){if(he){let r=new TextEncoder().encode(n);return crypto.subtle.digest("SHA-256",r).then(Y)}return Y((0,j.default)(n))})}function G(n){let r=new Uint8Array(n);if(K)window.crypto.getRandomValues(r);else for(let o=0;o<n;o+=1)r[o]=Math.floor(Math.random()*Math.floor(255));return pe(r)}function Q(){return C(this,null,function*(){let n=G(128),r=G(128),o=yield ve(r);return{verifier:r,challenge:o,state:n}})}var Z=class extends X.Extension.Internal{constructor(){super(...arguments);this.name="oauth";this.config={};this.compat={"magic-sdk":">=2.4.6","@magic-sdk/react-native":!1}}loginWithRedirect(r){return this.utils.createPromiEvent(o=>C(this,null,function*(){let{provider:_,query:p}=yield ge.call(this,r);window.location.href=new URL(`/v1/oauth2/${_}/start?${p}`,this.sdk.endpoint).href,o()}))}getRedirectResult(){let r=window.location.search,o=window.location.origin+window.location.pathname;return window.history.replaceState(null,"",o),ye.call(this,r)}},H="oauth_redirect_metadata";function ge(n){return C(this,null,function*(){yield this.utils.storage.removeItem(H);let{provider:r,redirectURI:o,scope:_,loginHint:p}=n,{verifier:w,challenge:R,state:d}=yield Q(),h=JSON.stringify({verifier:w,state:d});return yield this.utils.storage.setItem(H,h),{query:[`magic_api_key=${encodeURIComponent(this.sdk.apiKey)}`,`magic_challenge=${encodeURIComponent(R)}`,`state=${encodeURIComponent(d)}`,`platform=${encodeURIComponent("web")}`,_&&`scope=${encodeURIComponent(_.join(" "))}`,o&&`redirect_uri=${encodeURIComponent(o)}`,p&&`login_hint=${encodeURIComponent(p)}`].reduce((m,a)=>a?`${m}&${a}`:m),provider:r,redirectURI:o}})}function ye(n){return this.utils.createPromiEvent((r,o)=>C(this,null,function*(){var m;let _=yield this.utils.storage.getItem(H),{verifier:p,state:w}=JSON.parse(_);this.utils.storage.removeItem(H);let R=this.utils.createJsonRpcRequestPayload("magic_oauth_parse_redirect_result",[n,p,w]),d=yield this.request(R),h=d,f=d;f.error&&o(this.createError(f.error,(m=f.error_description)!=null?m:"An error occurred.",{errorURI:f.error_uri,provider:f.provider})),r(h)}))}module.exports=le(me);
//# sourceMappingURL=index.js.map
