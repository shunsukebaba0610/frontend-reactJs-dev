var re=Object.create;var H=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ie=Object.getPrototypeOf,oe=Object.prototype.hasOwnProperty;var ae=n=>H(n,"__esModule",{value:!0});var k=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports);var se=(n,r,c,_)=>{if(r&&typeof r=="object"||typeof r=="function")for(let p of ne(r))!oe.call(n,p)&&(c||p!=="default")&&H(n,p,{get:()=>r[p],enumerable:!(_=te(r,p))||_.enumerable});return n},T=(n,r)=>se(ae(H(n!=null?re(ie(n)):{},"default",!r&&n&&n.__esModule?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var C=(n,r,c)=>new Promise((_,p)=>{var w=h=>{try{d(c.next(h))}catch(f){p(f)}},R=h=>{try{d(c.throw(h))}catch(f){p(f)}},d=h=>h.done?_(h.value):Promise.resolve(h.value).then(w,R);d((c=c.apply(n,r)).next())});var P=k((I,F)=>{(function(n,r){typeof I=="object"?F.exports=I=r():typeof define=="function"&&define.amd?define([],r):n.CryptoJS=r()})(I,function(){var n=n||function(r,c){var _=Object.create||function(){function e(){}return function(t){var s;return e.prototype=t,s=new e,e.prototype=null,s}}(),p={},w=p.lib={},R=w.Base=function(){return{extend:function(e){var t=_(this);return e&&t.mixIn(e),(!t.hasOwnProperty("init")||this.init===t.init)&&(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=w.WordArray=R.extend({init:function(e,t){e=this.words=e||[],t!=c?this.sigBytes=t:this.sigBytes=e.length*4},toString:function(e){return(e||f).stringify(this)},concat:function(e){var t=this.words,s=e.words,i=this.sigBytes,g=e.sigBytes;if(this.clamp(),i%4)for(var v=0;v<g;v++){var b=s[v>>>2]>>>24-v%4*8&255;t[i+v>>>2]|=b<<24-(i+v)%4*8}else for(var v=0;v<g;v+=4)t[i+v>>>2]=s[v>>>2];return this.sigBytes+=g,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=r.ceil(t/4)},clone:function(){var e=R.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],s=function(y){var y=y,A=987654321,B=4294967295;return function(){A=36969*(A&65535)+(A>>16)&B,y=18e3*(y&65535)+(y>>16)&B;var x=(A<<16)+y&B;return x/=4294967296,x+=.5,x*(r.random()>.5?1:-1)}},i=0,g;i<e;i+=4){var v=s((g||r.random())*4294967296);g=v()*987654071,t.push(v()*4294967296|0)}return new d.init(t,e)}}),h=p.enc={},f=h.Hex={stringify:function(e){for(var t=e.words,s=e.sigBytes,i=[],g=0;g<s;g++){var v=t[g>>>2]>>>24-g%4*8&255;i.push((v>>>4).toString(16)),i.push((v&15).toString(16))}return i.join("")},parse:function(e){for(var t=e.length,s=[],i=0;i<t;i+=2)s[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4;return new d.init(s,t/2)}},m=h.Latin1={stringify:function(e){for(var t=e.words,s=e.sigBytes,i=[],g=0;g<s;g++){var v=t[g>>>2]>>>24-g%4*8&255;i.push(String.fromCharCode(v))}return i.join("")},parse:function(e){for(var t=e.length,s=[],i=0;i<t;i++)s[i>>>2]|=(e.charCodeAt(i)&255)<<24-i%4*8;return new d.init(s,t)}},o=h.Utf8={stringify:function(e){try{return decodeURIComponent(escape(m.stringify(e)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(e){return m.parse(unescape(encodeURIComponent(e)))}},u=w.BufferedBlockAlgorithm=R.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=o.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,s=t.words,i=t.sigBytes,g=this.blockSize,v=g*4,b=i/v;e?b=r.ceil(b):b=r.max((b|0)-this._minBufferSize,0);var y=b*g,A=r.min(y*4,i);if(y){for(var B=0;B<y;B+=g)this._doProcessBlock(s,B);var x=s.splice(0,y);t.sigBytes-=A}return new d.init(x,A)},clone:function(){var e=R.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),a=w.Hasher=u.extend({cfg:R.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:512/32,_createHelper:function(e){return function(t,s){return new e.init(s).finalize(t)}},_createHmacHelper:function(e){return function(t,s){return new l.HMAC.init(e,s).finalize(t)}}}),l=p.algo={};return p}(Math);return n})});var z=k((S,W)=>{(function(n,r){typeof S=="object"?W.exports=S=r(P()):typeof define=="function"&&define.amd?define(["./core"],r):r(n.CryptoJS)})(S,function(n){return function(r){var c=n,_=c.lib,p=_.WordArray,w=_.Hasher,R=c.algo,d=[],h=[];(function(){function o(e){for(var t=r.sqrt(e),s=2;s<=t;s++)if(!(e%s))return!1;return!0}function u(e){return(e-(e|0))*4294967296|0}for(var a=2,l=0;l<64;)o(a)&&(l<8&&(d[l]=u(r.pow(a,1/2))),h[l]=u(r.pow(a,1/3)),l++),a++})();var f=[],m=R.SHA256=w.extend({_doReset:function(){this._hash=new p.init(d.slice(0))},_doProcessBlock:function(o,u){for(var a=this._hash.words,l=a[0],e=a[1],t=a[2],s=a[3],i=a[4],g=a[5],v=a[6],b=a[7],y=0;y<64;y++){if(y<16)f[y]=o[u+y]|0;else{var A=f[y-15],B=(A<<25|A>>>7)^(A<<14|A>>>18)^A>>>3,x=f[y-2],Y=(x<<15|x>>>17)^(x<<13|x>>>19)^x>>>10;f[y]=B+f[y-7]+Y+f[y-16]}var G=i&g^~i&v,Q=l&e^l&t^e&t,X=(l<<30|l>>>2)^(l<<19|l>>>13)^(l<<10|l>>>22),Z=(i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25),D=b+Z+G+h[y]+f[y],ee=X+Q;b=v,v=g,g=i,i=s+D|0,s=t,t=e,e=l,l=D+ee|0}a[0]=a[0]+l|0,a[1]=a[1]+e|0,a[2]=a[2]+t|0,a[3]=a[3]+s|0,a[4]=a[4]+i|0,a[5]=a[5]+g|0,a[6]=a[6]+v|0,a[7]=a[7]+b|0},_doFinalize:function(){var o=this._data,u=o.words,a=this._nDataBytes*8,l=o.sigBytes*8;return u[l>>>5]|=128<<24-l%32,u[(l+64>>>9<<4)+14]=r.floor(a/4294967296),u[(l+64>>>9<<4)+15]=a,o.sigBytes=u.length*4,this._process(),this._hash},clone:function(){var o=w.clone.call(this);return o._hash=this._hash.clone(),o}});c.SHA256=w._createHelper(m),c.HmacSHA256=w._createHmacHelper(m)}(Math),n.SHA256})});var q=k((U,L)=>{(function(n,r){typeof U=="object"?L.exports=U=r(P()):typeof define=="function"&&define.amd?define(["./core"],r):r(n.CryptoJS)})(U,function(n){return function(){var r=n,c=r.lib,_=c.WordArray,p=r.enc,w=p.Base64={stringify:function(d){var h=d.words,f=d.sigBytes,m=this._map;d.clamp();for(var o=[],u=0;u<f;u+=3)for(var a=h[u>>>2]>>>24-u%4*8&255,l=h[u+1>>>2]>>>24-(u+1)%4*8&255,e=h[u+2>>>2]>>>24-(u+2)%4*8&255,t=a<<16|l<<8|e,s=0;s<4&&u+s*.75<f;s++)o.push(m.charAt(t>>>6*(3-s)&63));var i=m.charAt(64);if(i)for(;o.length%4;)o.push(i);return o.join("")},parse:function(d){var h=d.length,f=this._map,m=this._reverseMap;if(!m){m=this._reverseMap=[];for(var o=0;o<f.length;o++)m[f.charCodeAt(o)]=o}var u=f.charAt(64);if(u){var a=d.indexOf(u);a!==-1&&(h=a)}return R(d,h,m)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function R(d,h,f){for(var m=[],o=0,u=0;u<h;u++)if(u%4){var a=f[d.charCodeAt(u-1)]<<u%4*2,l=f[d.charCodeAt(u)]>>>6-u%4*2;m[o>>>2]|=(a|l)<<24-o%4*8,o++}return _.create(m,o)}}(),n.enc.Base64})});import{Extension as le}from"magic-sdk";var E=(r=>(r.ParseRedirectResult="magic_oauth_parse_redirect_result",r))(E||{}),ce=(o=>(o.InvalidRequest="invalid_request",o.InvalidClient="invalid_client",o.InvalidScope="invalid_scope",o.InvalidGrant="invalid_grant",o.UnauthorizedClient="unauthorized_client",o.UnsupportedResponseType="unsupported_response_type",o.UnsupportedGrantType="unsupported_grant_type",o.UnsupportedTokenType="unsupported_token_type",o.AccessDenied="access_denied",o.ServerError="server_error",o.TemporarilyUnavailable="temporarily_unavailable",o))(ce||{});var $=T(z()),M=T(q()),N="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",j=typeof window!="undefined"&&!!window.crypto,ue=j&&!!window.crypto.subtle;function fe(n){return Array.from(n).map(r=>N[r%N.length]).join("")}function J(n){let r=c=>c.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");if(n instanceof ArrayBuffer){let c=new Uint8Array(n),_=Array.from(c).map(w=>String.fromCharCode(w)).join(""),p=btoa(_);return r(p)}return r(M.default.stringify(n))}function de(n){return C(this,null,function*(){if(ue){let r=new TextEncoder().encode(n);return crypto.subtle.digest("SHA-256",r).then(J)}return J((0,$.default)(n))})}function V(n){let r=new Uint8Array(n);if(j)window.crypto.getRandomValues(r);else for(let c=0;c<n;c+=1)r[c]=Math.floor(Math.random()*Math.floor(255));return fe(r)}function K(){return C(this,null,function*(){let n=V(128),r=V(128),c=yield de(r);return{verifier:r,challenge:c,state:n}})}var he=class extends le.Internal{constructor(){super(...arguments);this.name="oauth";this.config={};this.compat={"magic-sdk":">=2.4.6","@magic-sdk/react-native":!1}}loginWithRedirect(r){return this.utils.createPromiEvent(c=>C(this,null,function*(){let{provider:_,query:p}=yield pe.call(this,r);window.location.href=new URL(`/v1/oauth2/${_}/start?${p}`,this.sdk.endpoint).href,c()}))}getRedirectResult(){let r=window.location.search,c=window.location.origin+window.location.pathname;return window.history.replaceState(null,"",c),ve.call(this,r)}},O="oauth_redirect_metadata";function pe(n){return C(this,null,function*(){yield this.utils.storage.removeItem(O);let{provider:r,redirectURI:c,scope:_,loginHint:p}=n,{verifier:w,challenge:R,state:d}=yield K(),h=JSON.stringify({verifier:w,state:d});return yield this.utils.storage.setItem(O,h),{query:[`magic_api_key=${encodeURIComponent(this.sdk.apiKey)}`,`magic_challenge=${encodeURIComponent(R)}`,`state=${encodeURIComponent(d)}`,`platform=${encodeURIComponent("web")}`,_&&`scope=${encodeURIComponent(_.join(" "))}`,c&&`redirect_uri=${encodeURIComponent(c)}`,p&&`login_hint=${encodeURIComponent(p)}`].reduce((m,o)=>o?`${m}&${o}`:m),provider:r,redirectURI:c}})}function ve(n){return this.utils.createPromiEvent((r,c)=>C(this,null,function*(){var m;let _=yield this.utils.storage.getItem(O),{verifier:p,state:w}=JSON.parse(_);this.utils.storage.removeItem(O);let R=this.utils.createJsonRpcRequestPayload("magic_oauth_parse_redirect_result",[n,p,w]),d=yield this.request(R),h=d,f=d;f.error&&c(this.createError(f.error,(m=f.error_description)!=null?m:"An error occurred.",{errorURI:f.error_uri,provider:f.provider})),r(h)}))}export{ce as OAuthErrorCode,he as OAuthExtension,E as OAuthPayloadMethods};
//# sourceMappingURL=index.mjs.map
